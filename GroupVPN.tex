\documentclass[conference]{IEEEtran}

\usepackage{url}
\usepackage{multirow}
\usepackage{array}
\usepackage{epsfig}
\usepackage{footnote}
\usepackage{amsmath}
\usepackage{algorithmic}

\setlength{\parskip}{0pt}
\setlength{\parsep}{0pt}
\setlength{\headsep}{0pt}
\setlength{\topskip}{0pt}
\setlength{\topmargin}{0pt}
\setlength{\footskip}{0pt}

\setlength{\topsep}{2pt}
\setlength{\partopsep}{0pt}
\setlength{\itemsep}{0pt}

\setlength{\floatsep}{4pt}
\setlength{\dblfloatsep}{4pt}
\setlength{\textfloatsep}{4pt}
\setlength{\dbltextfloatsep}{4pt}
\setlength{\abovecaptionskip}{4pt}
\setlength{\intextsep}{2pt}

\widowpenalty=10000
\clubpenalty=10000

\begin{document}

\title{On the Design of  Autonomic, Decentralized VPNs}

\author{
\IEEEauthorblockA{
  David Isaac Wolinsky,
  Kyungyong Lee,
  P. Oscar Boykin,
  Renato Figueiredo
}
\IEEEauthorblockN{
  University of Florida
}
}

\maketitle
\begin{abstract}

Decentralized and P2P (peer-to-peer) VPNs (virtual private networks) have
recently become quite popular for connecting users in small to medium
collaborative environments, such as academia, businesses, and homes.  In the
realm of VPNs, there exist centralized, decentralized, and P2P solutions.
Centralized systems require a single entity to provide and manage VPN
server(s); decentralized approaches allow more than one entity to share the
management responsibility for the VPN infrastructure, while existing P2P
approaches rely on a centralized infrastructure but allow users to bypass it to
form direct low-latency, high-throughput links between peers.  In this paper,
we describe a novel VPN architecture that can claim to be both decentralized
and P2P, using methods that lower the entry barrier for VPN deployment compared
to other VPN approaches.  Our solution extends existing work on IP-over-P2P
(IPOP) overlay networks to address challenges of configuration, management,
bootstrapping, and security.  We present the first implementation and analysis
of a P2P system secured by DTLS (datagram transport layer security) along with
decentralized techniques for revoking user access.

\end{abstract}

\section{Introduction}

A Virtual Private Network (VPN) provides the illusion of a local area network
(LAN) spanning a wide area network (WAN) by creating secure\footnote{For the
remainder of this paper, unless explicitly stated otherwise, security implies
encryption and mutual authentication between peers.} communication links
amongst participants.  Common uses of VPNs include secure access to enterprise
network resources from remote/insecure locations, connecting distributed
resources from multiple sites, and establishing virtual LANs for multiplayer
video games and media sharing over the Internet.

The architecture described in this paper addresses usage scenarios where VPNs
are desired but complexity in deployment and management limits their
applicability.  These include collaborative academic environments linking
individuals spanning multiple institutions, where coordinated configuration of
network infrastructure across the different sites is often impractical.
Another example is the small/medium business (SMB) environment, where it is
often desirable to securely connect desktops and servers across distributed
sites without incurring the complexity or management costs of traditional VPNs.
Such a VPN could be used to enable extended families to share media among
themselves, such as family videos and pictures, where existing VPNs may be too
complicated and where hosting by centralized service may be undesirable for
privacy reasons.

The model of a VPN for collaboration considered in this paper is motivated from
our Archer~\cite{archer} project.  Archer provides a dynamic and decentralized
Grid environment for computer architecture researchers to share and access
voluntary compute cycles with each other.  Use of centralized systems would
limit the scope of Archer and require dedicated administration, whereas
existing decentralized solutions require manual configuration of links between
peers, which is beyond the scope of Archer's target users.  Current P2P VPN
approaches either lack scalability or proper security components to be useful
for VPN approaches.

We began our original foray into user-friendly VPN approaches with
IPOP~\cite{ipop}.  Previous work on IPOP focused on the routing mechanisms and
address allocation with multiple virtual networks (VNs) sharing a single P2P
overlay.  Deploying a private overlay would require the user to deploy their
own infrastructure including necessary security underlay, such as IPsec.
Sharing an overlay has significant drawbacks.  A misconfigured peer could
easily disable the entire overlay, rendering all VPNs useless, and the system
would have to be recreated as there exists no methods to remove the peer from
such a system.  Without a shared overlay, each VPN would need to deploy a P2P
infrastructure prior to the VPN system, at which point, users may reconsider
the approach and prefer a more traditional centralized approach.

To make an easy-to-use, fully decentralized and P2P VPN, we extend the IPOP
concept to support bootstrapping from public infrastructures and overlays into
private P2P overlays whose membership is limited to an individual VPN user
base.  The key concept behind our work is based upon Castro et
al.~\cite{one_ring}, who suggests a single overlay for bootstrapping service
overlays.  However, an overlay secured only by ambiguity, obfuscation, or lack
of relevance may eventually be discovered and compromised by malicious
individuals.  As such, we present the first implementation and evaluation of an
overlay with secure communication both between end points in the P2P overlay
(e.g. VPN nodes) as well as between nodes connected by overlay edges.  Security
requires a means for peer revocation; however, current revocation techniques
rely on centralized systems such as certificate revocation lists (CRLs). Our
proposed approach allows revocation using scalable techniques provided by the
P2P overlay itself.  We call the completed system and the interface used to
administrate it {\bf GroupVPN}, a novel VPN architecture that extends IPOP to
create a novel secured decentralized P2P VPN.

The rest of this paper is organized as follows.  Section~\ref{background}
describes the baseline IPOP architecture used as a starting point for this work.  
We present a framework for securing both IPOP and the P2P overlay in
Section~\ref{security}.  Section~\ref{revocation} overviews our approaches for
decentralized certificate revocation.  The complete system, GroupVPN, is
presented in Section~\ref{groupvpn}.  Section~\ref{related_work} compares and
contrasts our work with related work.  Section~\ref{conclusions} concludes the
paper.

\section{Background}
\label{background}

This section describes the core organization of IPOP, a structured P2P virtual
network, including background on structured overlays, address allocation and
discovery, and connectivity.

\subsection{P2P Overlays}

The type of P2P overlay chosen for a VPN has an effect on how easy the VPN is
to program, deploy, and secure, on its efficiency, and on its scalability.  The
two primary infrastructures for P2P overlays are unstructured and structured
systems.  Unstructured systems use mechanisms such as global knowledge,
broadcasts, or stochastic techniques~\cite{unstruct_v_struct} to search the
overlay. As the system grows, maintaining and searching this state may not
scale.  Alternatively, structured approaches maintain provide guaranteed search
times typically with a lower bound of $O(\log N)$, where N is the size of the
network.  In terms of complexity, for small systems, unstructured systems may
be easier to implement but as the system grows it may become inefficient.

IPOP uses a structured P2P framework named Brunet~\cite{brunet}, which is based
upon Symphony~\cite{symphony}.  Structured systems are able to provide bounds
on routing and lookup operations by self-organizing into well-defined
topologies, such as a one-dimensional ring or a hypercube.  Links in the
overlay can be made to guarantee efficient lookup and/or routing times (e.g.
Brunet automatically creates links between peers that communicate often to
achieve efficiency in IP-over-P2P communication).

A key component of most structured overlays is support for decentralized
storage/retrieval of information such as a distributed hash table (DHT).  The
DHT builds upon the existence of a P2P address space.  All peers in a
structured system have a unique, uniformly distributed P2P address.  A DHT maps
look up values or keys (usually by a hashing function) into the P2P address
space.  While there are various forms of fault tolerance, a minimalist DHT
stores values at the node whose address is closest to the value's key.  DHTs
can be used to coordinate organization and discovery of resources, making them
attractive for self-configuration and organization in decentralized
collaborative environments.  As explained in the next section, IPOP, uses a DHT
to coordinate decentralized organization.

\begin{figure*}[ht]
\centering
\includegraphics[width=2.5in,angle=-90]{figs/bootstrap_brunet_light.ps}
\caption{Bootstrapping a private overlay using Brunet}
\label{fig:bootstrap}
\end{figure*}

\subsection{Connecting to the VPN}

To connect to IPOP, a peer needs only to connect to an existing Brunet
infrastructure.  Many IPOP systems can coexist sharing a single overlay.  The
motivation for doing so is that bootstrapping a P2P system can be challenging,
requiring users to have access to public IP addressable nodes or being able to
configure a router or firewall to enable inbound connections.

A peer connected to IPOP's P2P infrastructure can take advantage of its support
for NAT traversal through hole punching~\cite{ice}.  When performing hole
punching, peers first obtain mappings of their private IP address and port to
their public IP address and port and then exchange them over a shared medium,
in this case the P2P overlay.  The peers attempt to simultaneously form
connections with each other, tricking NATs and firewalls into allowing inbound
connections, because the NAT believed an outbound flow already exists.  In case
peers cannot establish direct connectivity, messages can be relayed through the
P2P overlay to each other, though with added latency and reduced throughput.

This approach enables peers behind NATs and firewalls to seamlessly connect to
each other, without requiring peers to host their own bootstrap servers.  If a
peer were to host their own bootstrap servers, they first need a public IP
address and bind the application to a port on that system.  At which point,
they could share the IP, port pair with other peers in the VPN.  Though if they
were to go offline or their IP address changes the P2P infrastructure, new
users would be unable to join.

\subsection{Organization}

In the context of VPNs, structured overlays can handle organization of the
network space, address allocation and discovery, decentrally through the use of
a DHT. Approaches along these lines have been proposed in~\cite{pcgrid07,i3}.  Membership in
the VPN includes a matching membership in the structured overlay, thus all VPN
peers have a P2P address.  To address the challenges of having multiple VPNs in
the same overlay, each IPOP group has its own namespace, reducing the
likelihood of overlap.  To enable scalable and decentralized address allocation
and discovery, peers store mappings of IP address to P2P address into the DHT,
typically of the form $hash(namespace + IP) = P2P address$.  Thus a peer
attempting to allocate an address will insert this (key, value) pair into the
overlay.  The first peer to do this will be the owner of the IP address
allocation.  Therefore the DHT must support atomic writes.

Mechanisms to self-configure the IP address and network parameters of the local
system can be provided by DHCP (decentralized host configuration protocol),
manually configuring the IP address, or the VPN hooking into O/S APIs.  Address
discovery is initiated when an outgoing packet for a remote peer arrives at the
VPN software.  At which point, the VPN will query the DHT with the IP address
to obtain the owner's P2P address and forward the packet to the destination.
Discussion on both these topics is further covered in our previous
work~\cite{sc09}.

\section{Experimental Environment}

Throughout this paper, our quantitative evaluation environment uses both real
deployments on PlanetLab and simulation.  The various evaluations dictate which
mechanism we use.  When the perspective of a single node is useful, PlanetLab
provides good results, though when attempting to measure detailed behavior of
the entire system using PlanetLab can results in significant error.

IPOP uses Brunet as the underlying P2P infrastructure for connectivity.  Brunet
has been in active development for the past 5 years.  Prior to releasing
updates, the code is run on PlanetLab~\cite{planetlab} for a period of 2 weeks.
PlanetLab consists of of nearly 1,000 resources distributed across Earth.  In
practical applications, though, roughly 40\% of the resources are unavailable
at any given time and the remaining behave somewhat unpredictably.  This
unpredictability provides behavior, that many times, is more effective at
finding bugs than users tests.

Deploying on PlanetLab takes approximately 15 minutes to bootstrap all the
resources and then many more to verify a certain behavior, making regression
testing and verification tests complicated.  To address this, we have extended
Brunet to support a simulation mode. The simulator inherits the all of the
Brunet P2P overlay logic, but uses simulated virtual time based upon an
event-driven scheduler instead of physical time.  Furthermore, the simulation
framework uses a specialized transport layer to avoid the overhead of using TCP
or UDP on the host system, both of which are limited resources and can hamper
the ability to simulate large systems.   The specialized transport uses
datagrams to pass messages between nodes, thus from the node's perspective, it
is very similar to a UDP transport and can simulate both latency and packet
dropping.  Latency between all node pairs is set to 100 ms.

Both simulation and real system evaluation provide unique advantages.
Simulations allow faster than real time execution of reasonable sized networks
(up to a few thousand) using a single resource, while enabling easy debugging.
In contrast, deployment on real systems, in particular PlanetLab, presents
opportunities to add non-deterministic dynamic behavior into the system which
can be difficult to replicate, such as network connectivity glitches and long
CPU delays on processing.

\section{Towards Private Overlays}

Many users of IPOP began by using the shared overlay and, once comfortable,
move towards hosting their own infrastructure.  Some are successful without
assistance from us, while a majority are not.  The most common issue preventing
users from hosting their own independent IPOP systems was the result of network
configuration issues.  In short, users were able to easily join the shared
overlay, but similar attempts to construct their own were hindered.

Bootstrapping a P2P system requires expertise in network administration.  To
enable users to bootstrap their own private overlays, we previously
investigated means by which a public overlay could be used to bootstrap a
private overlay.

Our approach for bootstrapping private systems requires an overlay to support a
methods for peers to discover each other, relay messages, and obtain their
public address mapping as described in~\cite{p2p10}.  Examples of other
potential bootstrap overlays include popular and well established P2P systems,
such as Gnutella, Skype, and Kademlia.  Our initial work supports bootstrapping
from XMPP (Jabber) systems and our own P2P overlay, Brunet.

To bootstrap from an existing Brunet overlay, peers first insert their public
overlay node address into the key represented by $hash(\$Private Overlay
Namespace)$ and continue to do so regularly until they disconnect, so as to not
let the entry become stale and disappear.  Peers attempting to bootstrap into
the private overlay can then query this key and obtain a list of public overlay
nodes that are currently acting as proxies into the private overlay.  By using
the public overlay as a transport, similar to UDP or TCP, the private overlay
node forms bootstrapping connections via the public overlay.  At which point,
overlay bootstrapping proceeds as normal.  The entire process is represented in
Figure~\ref{fig:bootstrap}.

In a small private overlay, there is a possibility that none of the members
have a public address, making it difficult to provide overlay based NAT
traversal.  Rather than having a special case for NAT traversal for private
overlays, our model has the private overlay share TCP and UDP sockets with the
public overlay.  This mechanism, referred to as {\em ``pathing''}, allows
multiplexing a single UDP socket and listening TCP socket by many overlays.
This is only possible due to the generic transports library of the Brunet P2P
overlay, which does not differentiate UDP, TCP, or even relayed links.  Pathing
works as a proxy, intercepting a link creation request from a local entity,
mapping that to a path, and then requesting from the remote entity a link for
that path.  The underlying link is then wrapped by pathing and given to the
correct overlay node, resulting in a completely transparent multiplexing of a
TCP and UDP sockets, thereby enabling the NAT traversal in one overlay to
benefit the other.  Once a link has been established, the pathing information
is irrelevant, limiting the overhead into the system to a single message
exchange during link establishment.

\subsection{Time to Bootstrap a Private Overlay}

In our previous work~\cite{p2p10}, we only verified that generic private P2P
overlays could be bootstrapped using a small set of resources behind NATs.
Here we focus on the overheads in bootstrapping private GroupVPNs overlays.
The time to bootstrap can be derived analytically by considering the minimum
steps to become connected to the private overlay and the average delay between
peers.  In Brunet, peers begin by forming leaf or bootstrapping connections and
use these to communicate with the neighbor or peer in the P2P network nearest
to their P2P address.  The process to form a connection can be done in as few
as 4 messages and up to 5, if the peers only know each other's P2P address,
which is the case for neighbor connections.

Assuming the initiating peer already has IP address information for the remote
peer, the initiating peer sends to the remote peer a message expressing the
desire for a connection.  The remote node responds by either rejecting the
request or committing to the connection.  In the follow up exchange, the
initiating peer commits to forming the connection and the remote peer confirms
reception.  The two phase commit process is used to handle the complexity that
ensues when multiple simultaneous connection attempts occur in parallel.  All
these messages take $1$ hop, since they are direct links between peers.

When peers only have each other's P2P address and the initiating peer is behind
a NAT, it may take fifth and sometimes a sixth message.  These messages are
requests for the remote peers IP addresses as well as asking the peer to
connect with the initiating peer, addressing the case where the remote peer is
behind a NAT and cannot handle inbound messages.  Since these messages are
routed over the overlay, they take $\log(N)$ hops, where $N$ is the network
size of the public overlay.

A similar process occurs for the private overlay bootstrapping, though the
first step is to acquire P2P addresses of other participants through the DHT,
an operation typically taking $2 *\log(N)$ time.  In this case, the leaf
connections do not communicate directly, rather, they use the public overlay,
meaning that some of the $1$ time operations above, now take $\log(N)$.
Finally, the initial step of finding the nearest remote peer in the private
overlay takes $\log(N) + \log(n)$, where $n$ is the network size of the private
overlay.

Given this model, the hop count for each operation individually is: public
overlay bootstrapping takes $8 + \log(N)$, DHT operations take $2 * \log(N)$,
and private overlay bootstrapping takes $4 + 5 * \log(N) + \log(n)$.  So the
entire private overlay bootstrapping takes $12 + 8 * \log(N) + \log(n)$ hops.
Clearly, dominating overhead in bootstrapping the private overlay is the time
it takes to perform overlay operations on the private overlay ($\log(N)$).
Thus assuming a network size of 512 public and 8 private, a node should be
connected within 87 hops or 8.7 seconds using the 100 ms time used in the
simulator.

To evaluate the actual code base, we employed tests using both PlanetLab and
the simulator.  100 tests were run for each of the various network sizes.
Though due to difficulty in controlling network sizes in PlanetLab, we set each
PlanetLab node to randomly decide if it would connect to the private overlay.
The network sizes were then plugged into the simulator and the analytical
model.  The average public network size for each of these tests was 600.  Our
results are presented in Figure~\ref{fig:private_bootstrapping}.  Note:  we
performed measurements for many more private network sizes, but all the results
were so similar that it did not introduce anything of interest and are omitted
from our plots.

\begin{figure}[ht]
\centering
\includegraphics[width=2.5in]{figs/private.eps}
\caption{CDF of time to bootstrap a private overlay node in a private overlay
of the specified size using a public overlay consisting of 600 nodes.}
\label{fig:private_bootstrapping}
\end{figure}

Based upon the results presented in Figure~\ref{fig:private_bootstrapping}, the
bootstrapping time for implementations performs better than the analytical
model, most likely due to the simplicity of the analytical model.  It is of
interest that while the simulator results tend to be in a well defined zone,
the PlanetLab results have a few outliers with long bootstrap times.  This is
no doubt a result of timeouts in the system and nodes thought to be online are
offline, two issues we have not considered in this work.

\subsection{Overhead of Pathing}

Much like the previous experiment, this verifies that the pathing technique has
negligible overheads for VPN usage.  To determine the overheads, two GroupVPNs
are deployed on resources on the same gigabit LAN.  Then netperf is used to
evaluate both latency and throughput.  We ignore other specifications of the
machines as the system without pathing is used as the baseline.  The results,
Table~\ref{tab:pathing}, indicate that the use of pathing presents negligible
overhead for both throughput and latency, justifying the use of this approach
to transparently deal with NAT and firewall traversal.

\begin{table}[ht]
\centering
\begin{tabular}{|c||c|c|}
\hline & Latency (ms) & Throughput (Mbit/s) \\ \hline \hline
Standard & .303 & 225.27 \\ \hline
Pathing & .308 & 224.36 \\ \hline
\end{tabular}
\caption{Pathing overheads}
\label{tab:pathing}
\end{table}

\section{Security for the Overlay and the VPN}
\label{security}

Structured overlays are difficult to secure and a private overlay does not
security if it provides no means to limit access to the system.  Malicious
users can pollute the DHT, send bogus messages, and even prevent the overlay
from functioning, rendering the VPN useless.  To address this in means that
make sense for VPNs and common users, we have employed a public key
infrastructure (PKI) to encrypt and authenticate both communication between
peers as well as communication across the overlay, called point-to-point (PtP)
and end-to-end (EtE) communication, respectively.

Use of a PKI motivates from the ability to authenticate without a third party,
typical of many key distribution centers (KDC) used by other VPNs.  A PKI can
use either pre-exchange public keys or a certificate authority (CA) to provides
signed public keys.  Thus peers can form a relationship directly without
requiring the CA to be online.

The reasons for securing PtP and EtE are different.  Securing PtP communication
prevents unauthorized access to the overlay, as peers must authenticate with
each other for every link created.  Though once authenticated, a peer can
perform malicious acts and since the overlay allows for routing over it, the
peer can disguise the origination of the malicious acts.  By also employing EtE
security, the authenticity of messages transferred through an overlay can be
easily verified.  Though EtE security by itself, will not prevent unauthorized
access into the overlay.  By employing both PtP and EtE, overlays can be
secured from uninvited guests from the outside and can easily identify
malicious users on the inside.  Implementing both leads to important questions:
what mechanisms can be used to implement both and what are the effects of both
on an overlay and to a VPN on an overlay.

\subsection{Implementing Overlay Security}

There are various types of PtP links; for example, there are TCP and UDP
sockets, and relays across nodes and overlays.  EtE communication is
datagram-oriented, unless the overlay employs a userspace stream-based
reliability service.  Traditional approaches of securing communication such as
IPsec are not convenient due to complexity.  Security protocols that rely on
reliable connections, such as SSL or TLS are undesirable as well as they would
require a userpace implementation of reliable streams (akin to TCP).  As such,
we have implemented an abstraction akin to a security filter as presented in
Figure~\ref{fig:security_filter}, which enables nearly transparent use of
security libraries and protocols.  To this date, we have implemented both a
DTLS~\cite{dtls} filter using the OpenSSL implementation of DTLS as well as a
protocol that reuses cryptographic libraries provided by .NET that behaves
similarly to IPsec.

A security filter has two components: the manager, and individual sessions or
filters.  While the individual sessions could act as filters by themselves, by
combining with a manager, they can be configured for a common purpose and
security credentials.  This approach enables the use of security to be
transparent to the other components of the system as the manager handles
session establishment, garbage collection of expired sessions, and revocation
of peers.

\begin{figure}[ht]
\centering
\includegraphics[width=3in]{figs/secure_sender_stack_generic.png.eps}
\caption{An example of the abstraction of senders and receivers using a EtE 
secured chat application.  Each receiver and sender use the same abstracted
model and thus the chat application requires only high-level changes, such
as verifying the certificate used is Alice's and Bob's, to support security.}
\label{fig:security_filter}
\end{figure}

The strength in using certificates is the embedding of identity in the
certificate.  In network systems, the certificate uses the domain name to
uniquely identify and limit the use of a certificate.  When a CA signs the
certificate, by including the domain name, it ensures that users can trust that
a certificate is valid, while used to secure traffic to that domain.
Communication with another domain using the same certificate will raise a flag
and will result in the user not trusting the certificate.  In environments with
NATs, dynamic IP addresses, or portable devices, typical of P2P systems,
assigning a certificate to a domain name will be a hassle as it constrains
mobility and the type of users in the system. Furthermore, most users are
unaware of their IP address and changes to it.  Instead, a certificate is
signed against the user's P2P address and unique user name as delegated by the
CA.  The purpose of the former is for efficiency of revocation as discussed in
Section~\ref{revocation}.  During the formation of PtP links or while parsing
EtE messages, the two nodes discover each other's P2P addresses.  If the
addresses do not match the address on the verified certificate, the
communication need not proceed further.  

The use of a filter approach requires one change to the core software, such
that it verifies the identity of the remote side prior to allowing packets to
traverse the session.  In our system, we did this by means of a callback, which
presents the underlying sending mechanism, EtE or PtP, and the overlay address
stored in the certificate.  The receiver of the callback can attempt to cast it
into known objects. If successful, it will compare the overlay address with the
sender type.  If unsuccessful, it ignores the request.  If any callbacks return
that the sender does not match the identifier, the session is immediately
closed.

The last consideration comes in the case of EtE communication that provides an
abstraction layer.  For example, in the case of VPNs, where a P2P packet
contains an IP packet and thus a P2P address maps to a VPN IP address, a
malicious peer may establish a trusted link, but then hijack another users IP
session.  As such, the application must verify that the IP address in the IP
packet matches the P2P address of the sender of the P2P packet.

\subsection{Overheads of Overlay Security}

When applying an additional layer to a P2P system, there will be obvious
overheads in terms of time to connect with the overlay.  Other less obvious
effects will be throughput, latency, and processing overheads, with the
assumption that the P2P system will be used over a wide area network, where the
latency and throughput limitations due to the network conditions between two
points will make the overhead of security negligible.  Though bootstrapping
will be affected due to additional round trip messages used for forming secure
connections.

\begin{figure}[ht]
\centering
\includegraphics[width=2.5in]{figs/dtls.eps}
\caption{DTLS handshake}
\label{fig:dtls}
\end{figure}

For example, consider the DTLS handshake as presented in Figure~\ref{fig:dtls},
which consists of 6 messages or 3 round trips.  PtP security  may very well
have an effect on the duration of overlay bootstrapping.  There even exists a
possibility that with more messages during bootstrap, the probability one drops
is higher, which could, in turn, also have an effect, though possibly
negligible, on time to connect.  To evaluate these concerns, we have employed
both simulation and real system experiments.

The following experiments use both simulation and PlanetLab deployment to
evaluate time to connect a new node to an existing resource.  Then another
experiment is performed to evaluate how long it takes to bootstrap various
sized overlays if all nodes join at the same time.  This experiment is only
feasible via simulation as attempting to reproduce in a real system is
extremely difficult due to how quickly the operations complete.

\subsubsection{Adding a Single Node}

This experiment determines how long it takes a single node to join an existing
overlay with and without DTLS security.  The experiment is performed using both
simulation and a real deployed system.  After deploying a set of nodes without
security and with security on PlanetLab, a crawl was run to determine the size
of the network.  In both cases, the overlay maintained an average size of
around 600 nodes.  At which point, a new node connected to the overlay 1,000
times, generating a new P2P address each time, and thus connecting to a
different point in the overlay.  As soon as the node believed it had connected
to the correct location in the overlay, the experiment ended.  In the
simulation, a new overlay is created and afterward a new node joins, this is
repeated 100 times.  The test completes after the entire overlay agreed upon
being properly correct, a more rigorous test than that tested in the real
system.  The cumulative distribution functions obtained from the different
experiments are presented in Figure~\ref{fig:add_one}.

\begin{figure}[ht]
\centering
\includegraphics[width=2.5in]{figs/addone.eps}
\caption{Time in seconds for a single node to join a secure (dtls) and insecure
(nosec) structured overlay, using both PlanetLab (plab) and the Simulator
(sim).}
\label{fig:add_one}
\end{figure}

\subsubsection{Bootstrapping an Overlay}

The purpose of this experiment is to determine how quickly an overlay using
DTLS can bootstrap in comparison to one that does not given that there are no
existing participants.  Nodes in this evaluation are randomly given information
about 5 different nodes in the overlay and then all attempt to connect with
each other at the same time.  The evaluation completes after the entire overlay
has all nodes connected and in their proper position.  For each network size,
the test is performed 100 times and the average result is presented in
Figure~\ref{fig:bootstrap_eval}.

\begin{figure}[ht]
\centering
\includegraphics[width=2.5in]{figs/bootstrap.eps}
\caption{Time in seconds for a secure (dtls) and insecure (nosec) structured
overlay to bootstrap, given that all nodes bootstrap simulataneously.}
\label{fig:bootstrap_eval}
\end{figure}

\subsection{Discussion}

% figu 5 in black and white, it's hard to see which curve is which, the markers
% stack upon each other. can you improve this?
Both evaluations show that the overhead in using security is practically
negligible, when an overlay is small.  In the case of adding a single node, it
is clear that the simulation and deployment results agree, as the difference
between bootstrapping into an overlay with and without security remains nearly
the same.  Clearly this motivates the use of security if time to connect is the
most pressing question.

The time to bootstrap a secure overlay was not significantly more than that of
an insecure overlay.  What we realized is that complex connection handshaking,
as implemented in Brunet, seems to dominate connection establishment time.  For
example, in Brunet, two peers must communicate via the overlay prior to forming
a connection, and the system differentiates between bootstrapping connections
and overlay connections.  Thus even though a peer may have a bootstrapping
connection, it will need to go through the entire process to form an overlay
connection with a peer.  While this may lead to inefficiencies, this
simplification keeps the software more maintainable and easier to understand.

\section{Handling User Revocation}
\label{revocation}

Unlike decentralized systems that use shared secrets, in which the creator of
the overlay becomes powerless to control malicious users, a PKI enables the
creator to effectively remove malicious users.  Typical PKIs either use a
certificate revocation list (CRL) or online certificate verification protocols
such as Online Certificate Status Protocol (OCSP).  These approaches are
orthogonal to decentralized systems as they require a dedicated service
provider in order to verify a certificate. If the service provider is offline,
an application can only rely on historical information to make a decision on
whether or not to trust a link.  In a decentralized system, these features can
be enhanced so not to rely on a single provider.  In this section, we present
two mechanisms of doing so: storing revocations in the DHT and performing
overlay broadcast based revocations.

\subsection{DHT Revocation}

A DHT can be used to provide revocation similar to that of OCSP or CRLs, where
users can either query a service provider to obtain the validity of one or more
certificates.  A revocation can be stored in the DHT by signing the hash of a
certificate and the time stamp of revocation and storing all three in the DHT
at the key formed by the hashing of the certificate.  In doing so, revocations
will be uniformly distributed across the overlay, not relying on any single
entity.

The problem with the DHT approach is that it does not provide an event
notification for members currently communicating with the peer.  While peers
could continue to poll the DHT to determine a revocation, doing so is
inefficient.  Furthermore, a malicious peer, who has a valid but revoked
certificate could force every member in the overlay to query the DHT,
negatively affecting the DHT nodes storing the revocation.

\subsection{Broadcast Revocation}

Broadcast revocation can be used to address the deficiencies of DHT revocation.
As a topic of previous research works~\cite{broadcast, chord_broadcast},
structured overlays can be used without additional state to perform efficient
broadcasts from any point in the overlay to the entire overlay.  The form of
broadcast can be used to perform to notify the entire overlay immediately about
a new revocation.  In these papers, analysis and simulations have shown that
the approach can be completed in $O(\log^2 n)$ time.

\begin{figure}[ht]
\centering
\includegraphics[width=2.5in]{figs/tree.eps}
\caption{Broadcast performing a complete overlay broadcast}
\label{fig:tree}
\end{figure}

Our modified algorithm as illustrated in Figure~\ref{fig:tree} utilizes the
organization of a structured system with a circular address space that requires
peers be connected to those whose node addresses are the closest to their own,
features typical of 1-d structured overlays including Chord~\cite{chord},
Pastry~\cite{pastry}, and Symphony.  Using such an organization, it is possible
to do perform a broadcast with no additional state.  To perform a broadcast,
each node performs the following recursive algorithm:

\begin{algorithmic}
\STATE {\bf BROADCAST(start, end, message)}:
  \STATE RECEIVE(message)
  \FOR{$i$ in length(connections)}
    \STATE n\_start $\gets$ ADDRESS(connections$[i]$)
    \IF {n\_start $\not\in$ $[$start, end$)$}
      \STATE continue
    \ENDIF
    \STATE n\_end $\gets$ ADDRESS(connections$[i+1]$)
    \IF {n\_end $\not\in$ $[$start, end$)$}
      \STATE n\_end $\gets$ end
    \ENDIF
    \STATE msg $\gets$ (BROADCAST, n\_start, n\_end, message)
    \STATE SEND(connections$[i]$, msg)
  \ENDFOR
\end{algorithmic}
with ``connections'' as a circular list of connections in non-decreasing order
from the perspective of the node performing the current recursive, broadcast
step.

In this algorithm, broadcast initiator uses its own address as the start and
end, thus the broadcast will span the entire overlay after completing recursive
calls at each connected node.  A recursive end, ``n\_end'', must be inside the
region between ``start'' and ``end'', thus if the connection following the
current sending connection, ``connections$[i+1]$'', is not in that region, it
will only broadcast up to ``end'' and not the address specified by that
connection.  Finally, nodes, who have a connection to the malicious peer, will
end the connection prior to accidentally forwarding the message to the peer by
receiving and acting upon the revocation prior to forwarding the message.  To
summarize, the overlay is recursively partitioned amongst the nodes at each hop
in the broadcast.  By doing so, all nodes receive the broadcast without
receiving duplicate broadcast messages.

\subsection{Evaluation of Broadcast}

We performed an evaluation on the broadcast using the simulation to determine
how quickly peers in the overlay would receive the message.  The tested network
sizes ranged from 2 to 256 in powers of 2.  The tests were evaluations were
performed 100 times for each network size.  The CDF of hops for each node are
presented in Figure~\ref{fig:broadcast}.  The results make it quite clear that
the broadcast can efficiently distribute a revocation much more quickly than
$\log(N)$ time.

\begin{figure}[ht]
\centering
\includegraphics[width=2.5in]{figs/broadcast.eps}
\caption{Overlay broadcast time CDF.}
\label{fig:broadcast}
\end{figure}

\begin{figure*}[ht]
\centering
\includegraphics[width=2.5in,angle=-90]{figs/groupvpn.ps}
\caption{Process in bootstrapping a new GroupVPN instance.}
\label{fig:groupvpn}
\end{figure*}

\subsection{Discussion}

In contrast to the DHT solution, broadcast revocation occurs only once and does
not leave state behind.  Thus the broadcast is not a complete solution, as new
peers connected to the overlay or those who missed the broadcast message will
be unaware of a revocation.  Furthermore, if an overlay is shared by many VPNs,
it may prevent overlay broadcasting or itself may be inefficient.

The DHT solution by itself may also not sufficient as revocations may be lost
over time as the entries must have their leases renewed in the DHT.  To address
this condition, each peer maintains a local CRL and the owner of the overlay
can occasionally send updates to the CRL through an out of band medium, such as
e-mail.  A better long term solution may be the use of a gossip protocol so
that peers can share their lists with each other during bootstrapping phases.

A key assumption in using these is that a Sybil~\cite{sybil}, or collusion
attack, is difficult in the secured overlay.	 If a Sybil attack is successful,
both a DHT and broadcast revocation may be unsuccessful, though peers could fix
this problem by obtaining the CRL out of band.  In addition, previous
work~\cite{secure_routing} has described decentralized techniques to limit the
probability of such attacks from occurring.  In our approach, the use of
central authority to review certificate requests can be used to limit a single
user from obtaining too many certificates as well as ensuring uniform
distribution of that user's P2P addresses, further hampering the likelihood of
a Sybil attack.  The ability to automate this is left as future work.

One way to mitigate sybil attacks using the broadcast approach is to bundle
colluding offenders into a single revocation message.  That would prevent those
from colluding together to prevent each other's revocations.  Furthermore,
while not emphasized above, revocation in our system revokes by user name and
not individual certificates.  Combined these two components limit sybil attacks
against broadcast.

\section{Managing and Configuring the VPN}
\label{groupvpn}

While the PKI model applies to P2P overlays, setting up, deploying, and then
maintaining security credentials can easily become too complex to manage,
especially for non-experts.  Most PKI-enabled systems require the use of
command-line utilities and lack methods for assisting in the deployment of
certificates and policing users.  In order to facilitate use in real systems
with non-experts, it is important to have an easy to use framework.  Our
solution to this issue is a partially-automated PKI reliant on a group-based
Web interface distributable in forms of Joomla add-ons as well as a virtual
machine appliance.  In this environment, groups can share a common Web site,
while each group has their own unique CA.  Although this does not preclude
other methods of CA interaction, experience has shown that it provides a model
that is satisfactory for many use cases.

A group-based Web 2.0 site enables low overhead configuration of collaborative
environments.  The roles in a group environment can be divided into
administrators and users.  Users have the ability to join and create groups;
whereas administrators define network parameters, can accept or deny join
requests, remove users, and promote other users to administrators.  By applying
this to a VPN, the group environment provides a simple to use wrapper around
PKI, where the administrators of the group act as the CA and the members have
the ability to obtain signed certificates.  

Elaborating further, when a user joins a group, the administrator can enable
automatic signing of certificates or require prior review; and when peers have
overstayed their welcome, an administrator can revoke their certificate by
removing them from the group.  Revocations are handled as described in
Section~\ref{revocation}.  In the context of GroupVPN systems, a user
revocation list as opposed to a CRL simplifies revocation, since users and not
individual certificates will be revoked.

Registered users who create groups become administrators of their own groups.
When a user has been accepted into a group by its administrator, they are able
to download VPN configuration data from the Web site.  In addition to IP
address range, namespace, and security options, the configuration data also
contains the group website's address and a shared secret. Once downloaded,
configuration data is loaded by the GroupVPN during its configuration process.
The shared secret uniquely identifies the user, so that the Web site can
automatically sign the certificate (or enqueue it form manual signing,
depending on the group's policy).  Certificate requests consist of a public key
and the user's shared secret and are sent over HTTPS to the Web server.  Upon
receiving the signed certificate, peers are able to join the private overlay
and GroupVPN, enabling secure communication amongst the VPN peers.  The entire
bootstrapping process, including address resolution and communication with a
peer, is illustrated in Figure~\ref{fig:groupvpn}.

% not sure the paragraph below is needed.

There are many ways of implementing and hosting the Web site.  For example,
Google offers free hosting of Python web applications through Google Apps, an
option available if the user owns a domain.  Alternatively, the user could host
the group site on a public virtual network. In this case, peers interacting
with the GroupVPN would need to connect with the public virtual network in
order to create an account, get the configuration data, and retrieve a signed
certificate, at which point they could disconnect from it.  This does not
preclude the use of other social mediums nor a central site dedicated to the
formation of many GroupVPNs.  Many GroupVPNs can share a single site, so long
as the group members trust the site to host the CA private key.

\section{Related Work}
\label{related_work}

\subsection{VPNs}

Hamachi~\cite{hamachi} is a centralized P2P VPN provider.  Peers authenticate
with the website, use it to discover remote peers, and then connect with them.
The website itself provides a central group management environment, which can
be used to control access to the VPN.  While the Hamachi protocol claims to
support various types of security~\cite{hamachi_security}, the implementation
appears to only support the key distribution center (KDC).  This requires that
all peers establish trusted relationship through the central website.  The
Hamachi approach makes it easy for users to deploy their own services, but
places limitations on network size, uses a proprietary security stack, and does
not allow users to fork off from Hamachi and maintain their own system, if they
so desire.  In contrast, our approach presents a completely decoupled
environment, which allows peers to start using our shared system to bootstrap
private overlays and migrate away without cost if need be.  Our approach also
has the benefit of not relying on a centralized server to establish VPN links,
as the only process that is centralized is the signing of the certificate. In
Hamachi, if the central server goes offline, no new peers can join the VPN.

Campagnol VPN~\cite{campagnol} provides similar features to Hamachi: a P2P VPN
that relies on a central server for rendezvous or discovery of peers.  The key
differences between Hamachi and Campagnol is that Campagnol is free and does
not provide a service; users msut deploy their own rendezvous service.  The
authors of Campagnol also state that the current approach limits the total
number of peers sharing a VPN to 100 so not to overload the rendezvous service.
The current implementation does not support a set of rendezvous nodes, though
doing so would make the approach much more like ours.  In addition, the system
relies on traditional distribution of a CRL to handle revocation.

Tinc~\cite{tinc} is a mature, open source VPN, dating back to the early part of
2000.  Tinc is a decentralized VPN, which requires that users manually organize
an overlay and the Tinc uses its own routing protocols to determine optimum
paths.  In comparison to our approach, Tinc cannot be used to allow peers to
bootstrap private VPNs from an existing VPN, nor does Tinc automatically handle
churn in the VPN.  If a node connecting two separate pieces of the VPN overlay
goes offline, the VPN will be partitioned until a user manually creates a link
connecting the pieces.  Furthermore, Tinc does not form direct connections for
improved latency and throughput reasons, thus members acting as routes in the
overlay incur the price of acting as packet forwarders.

The last VPN, we discuss is the most similar like our's, its called
N2N~\cite{n2n}.  N2N uses unstructured p2p techniques to form an Ethernet based
VPN.  While their approach has built-in NAT traversal, like our's, it requires
that users deploy their own bootstrap and limits security to a single
pre-shared key for the entire VPN, thus users cannot be revoked.  Since N2N
provides Ethernet, users must provide their own mechanism for IP address
allocation, while discovery utilizes overlay broadcasting.  Thus there are
concerns that as systems get larger, N2N may not be very efficient.

\subsection{P2P Systems}

BitTorrent~\cite{bittorrent_security}, a P2P data sharing service,  supports
stream encryption between peers sharing files.  The purpose of BitTorrent
security is to obfuscate packets to prevent traffic shaping due to packet
sniffing. Thus BitTorrent security uses a weak stream cipher, RC4, and lacks
peer authentication as symmetric keys are exchanged through an unauthenticated
Diffie-Hellman process.

Skype~\cite{skype} provides decentralized audio and video communication to over
a million concurrent users.  While Skype does not provide documentation
detailing the security of its system, researchers~\cite{skype_auth,
skype_overview} have discovered that Skype supports both EtE and PtP security.
Though similar to Hamachi, Skype uses a KDC and does not let users setup their
own systems.

As of December 2009, the FreePastry group released an SSL enabled
FreePastry~\cite{pastry}.  Though relatively little is published regarding
their security implementation, the use of SSL prevents its application for use
in the overlay and for overlay links that do not use TCP, such as relays and
UDP.  Thus their approach is limited to securing environments that are not
behind NATs and firewalls that would prevent direct TCP links from forming
between peers.

\section{Conclusions}
\label{conclusions}

This paper overviews the architecture implementation of GroupVPN, a system that
is the first to demonstrate the practical feasibility of using structured
overlays as a basis for easy-to-use, group VPNs.  Explicitly, we have taken
common structured overlays and explored organization, public overlays for
connectivity, and private overlays for security and then described our GroupVPN
which binds them the components together to create collaborative environments
for configuration and management of VPNs.  This paper extends upon the IPOP
virtual network to support user-friendly approaches for users to create and
manage their own virtual private networks.  To accomplish this, each IPOP
system bootstraps into its own unique, secure P2P overlay.  This approach not
only enables secure communications in IPOP deployments but also enables for
more efficient overlay multicast and broadcast.

The use of service overlays significantly improves performance and maintenance.
Peers can easily control membership in the overlay and it presents unique
opportunities for decentralized revocation.  A DHT approach allows results to
be stored on the overlay instead of using centralized CRLs and broadcast to
immediately notify active participants of a revocation.  For future work, we
plan further investigating security concerns of using the decentralized
revocation techniques.  Furthermore, we plan on investigating the use of
overlay broadcasting for IP broadcasting and multicasting, though the current
approach places an unfair burden on the first few hops of a broadcast.

Without the functionality of GroupVPN, projects like the Grid Appliances and
its flagship application, Archer~\cite{archer}, would be impractical.  Archer
consists of over 500 resources from 5 different universities, including
University of Florida, Florida State University, Northeastern University,
University of Minnesota, and University of Texas.  In the past year, since
Archer came online, over 100 unique users have contributed and taken advantage
of the voluntary computing cycles.  A new user to the system begins by creating
an account at \url{Grid-Appliance.org} and requesting membership in the Archer
GroupVPN group.  Once access has been granted, users can obtain configuration
data used by the Grid Appliance initialization scripts to seamlessly add
resources to the grid.  This method allows independent submission sites, unlike
most grid systems that have a shared submission site, which require dedicated
administrators.  The use of existing decentralized VPNs in Archer and the Grid
Appliance would be severely limiting.  In the case of N2N, at least one peer
would have to maintain the bootstrap service and address allocations for the
VPN.  Tinc would require users to manually configure their networking overlays.
While Compagnol and Hamachi require the use of well known centralized peers.  

The GroupVPN has been used as the virtual network for the Grid Appliance,
enabling the creation of decentralized, collaborative environments for
computing grids.  Recently, grids at La Jolla Institute for Allergy and
Immunology and two in Eastern Europe went live using GroupVPN without receiving
any technical support from us.  Researchers at Clemson University and Purdue
have opted for this approach over centralized VPNs as the basis of their future
distributed compute clusters and have actively tested networks of over 700
nodes.

\small{
\bibliographystyle{IEEEtran}
\bibliography{GroupVPN}
}

\end{document}
